# 네모의 꿈 - 기능 명세서

## 📱 화면별 기능 상세

---

## 1. 로그인 (Login)

**경로**: `/login`
**접근**: 비로그인 사용자

### 기능

- Google OAuth 로그인
- 로그인 성공 시:
  - 팀 소속 O → 피드로 리다이렉트
  - 팀 소속 X → 온보딩으로 리다이렉트

### UI 요소

- 로고 (축구공 아이콘)
- "Google로 시작하기" 버튼
- 서비스 설명 문구

---

## 2. 온보딩 (Onboarding)

**경로**: `/onboarding`
**접근**: 로그인 완료 + 팀 미가입 사용자

### 기능

#### 2.1 팀 가입

- 초대 코드 입력
- 팀 정보 확인 (팀명, 멤버 수)
- 프로필 설정
  - 이름 (필수)
  - 포지션 (선택)
  - 등번호 (선택)
- "팀 가입하기" 버튼

#### 2.2 팀 생성

- 팀명 입력 (필수)
- 팀 컬러 선택 (기본값: #967B5D)
- 로고 업로드 (선택)
- 프로필 설정 (이름, 포지션, 등번호)
- "팀 만들기" 버튼
- 생성자는 자동으로 ADMIN 권한 부여

### 검증 규칙

- 팀명: 2-20자
- 초대 코드: 유효성 확인
- 이름: 1-20자 (필수)
- 등번호: 0-99

---

## 3. 피드 (Feed)

**경로**: `/` (홈)
**접근**: 로그인 + 팀 가입 완료

### 레이아웃

```
┌──────────────────────────┐
│ 전광판 배너 (TickerBanner) │
├──────────────────────────┤
│ 헤더 (+ 아이콘, 프로필)     │
├──────────────────────────┤
│                          │
│  폴라로이드 스택 (오늘)    │
│  [카드1] [카드2] [카드3]  │
│                          │
│  폴라로이드 스택 (어제)    │
│  [카드1] [카드2]         │
│                          │
│  폴라로이드 스택 (2일 전)  │
│  [카드1]                 │
│                          │
└──────────────────────────┘
```

### 3.1 전광판 배너

**위치**: 최상단 고정
**높이**: 1줄 (40px)

**표시 내용** (롤링):
1. 닦달 메시지 (최근 2시간 이내)
   - "OOO님이 XXX님을 닦달했어요!"
2. 활동 메시지
   - 새 일지: "OOO님이 운동 일지를 올렸어요!"
   - 새 운동: "새 운동이 올라왔어요! MM/DD"
   - POM: "OOO님이 POM으로 선정되었어요!"

**동작**:
- 좌→우 슬라이드 애니메이션
- 3초마다 다음 메시지로 전환
- 탭하면 해당 콘텐츠로 이동

### 3.2 헤더

**좌측**: 로고 (축구공 아이콘)
**우측**:
- `+` 아이콘: 일지 작성 (`/write`)
- 프로필 아이콘: 마이페이지 (`/my`)

### 3.3 폴라로이드 스택

**그룹핑**: 날짜별 (오늘, 어제, 2일 전, ...)

**기본 상태** (스택):
- 카드들이 겹쳐진 상태 (z-index로 깊이감 표현)
- 최상단 카드만 보임
- 스택 높이: 카드 1장 크기

**확장 상태** (탭 시):
- 수평 캐러셀로 펼쳐짐
- 좌우 스와이프로 카드 탐색
- 페이지네이션 인디케이터 표시

### 3.4 폴라로이드 카드

**크기**: 약 300x380px (화면 너비의 80%)

**구조**:
```
┌────────────────────┐
│ ╔══════════════╗   │ ← 흰색 외곽 프레임 (12px)
│ ║              ║   │
│ ║   [이미지]    ║   │ ← bg-team-50 사진 영역
│ ║              ║   │
│ ║──────────────║   │
│ ║ 이름 · 날짜   ║   │ ← 하단 정보
│ ║ 컨디션 ⭐⭐⭐  ║   │
│ ╚══════════════╝   │
└────────────────────┘
```

**표시 정보**:
- 사진 (없으면 기본 이미지)
- 작성자 이름
- 작성 날짜 (상대 시간, 예: "2시간 전")
- 컨디션 점수 (별 0-10개)
- 좋아요 수
- 댓글 수

**동작**:
- 탭 → 일지 상세 페이지로 이동
- 좋아요 아이콘 탭 → 즉시 좋아요 토글 (낙관적 업데이트)

### 3.5 데이터 로딩

**전략**: SWR (Stale-While-Revalidate)
- 캐시된 데이터 즉시 표시
- 백그라운드에서 최신 데이터 페치
- 자동 리프레시 (10초 간격)

**무한 스크롤**:
- 화면 하단 도달 시 다음 20개 로드
- 로딩 스피너 표시

---

## 4. 일지 작성 (Write)

**경로**: `/write`
**접근**: 로그인 + 팀 가입 완료

### 4.1 운동 선택

**개인 운동**
- 제목 입력 (필수, 1-50자)
- 날짜 선택 (기본값: 오늘)

**팀 운동 연결**
- 최근 팀 운동 목록 표시 (최근 7일)
- 선택 시 제목 자동 입력
- 미참석 운동도 선택 가능

### 4.2 일지 내용

**사진 업로드**
- 1장 (선택)
- Cloudinary 업로드
- 최대 10MB
- 미리보기 표시

**컨디션** (필수)
- 슬라이더: 0-10
- 별 아이콘으로 시각화
- 라벨: "별로예요" (0-3), "괜찮아요" (4-6), "최고예요!" (7-10)

**컨디션 이유** (필수)
- 텍스트 에리어
- Placeholder: "오늘 컨디션이 좋았거나 나빴던 이유를 적어주세요"
- 1-500자

**핵심 플레이** (필수)
- 텍스트 에리어
- Placeholder: "오늘 가장 기억에 남는 플레이나 순간을 적어주세요"
- 1-500자

**개선점** (필수)
- 텍스트 에리어
- Placeholder: "다음 운동에서 개선하고 싶은 점을 적어주세요"
- 1-500자

**태그** (선택)
- 팀원 멘션 (@username)
- 자동완성 지원
- 여러 명 태그 가능

### 4.3 저장

- "일지 올리기" 버튼
- 필수 항목 미입력 시 에러 표시
- 저장 성공 시:
  - 피드로 리다이렉트
  - 팀원 전체에 푸시 알림 발송 (작성자 제외)
  - 태그된 팀원에게 별도 알림 발송

---

## 5. 일지 상세 (Log Detail)

**경로**: `/log/[id]`
**접근**: 로그인 + 같은 팀 멤버

### 5.1 일지 내용

**헤더**:
- 작성자 프로필 (사진, 이름, 포지션)
- 작성 시간 (절대 시간, 예: "2026-02-09 14:30")
- 더보기 메뉴 (본인 일지만)
  - 수정
  - 삭제 (확인 다이얼로그)

**사진**: 전체 너비로 표시

**컨디션**:
- 점수 (별 아이콘)
- 이유 (텍스트)

**핵심 플레이**: 텍스트

**개선점**: 텍스트

**태그**:
- @username 형태로 표시
- 탭하면 해당 유저 프로필로 이동

**통계**:
- 좋아요 수
- 댓글 수

### 5.2 좋아요

- 하트 아이콘
- 탭하여 토글
- 좋아요 누른 사람 목록 (아바타 나열)
- 좋아요 시:
  - 즉시 UI 업데이트 (낙관적)
  - 작성자에게 푸시 알림 (본인 제외)

### 5.3 댓글

**댓글 목록**:
- 시간순 정렬 (오래된 순)
- 작성자 프로필 (아바타, 이름)
- 작성 시간 (상대 시간)
- 댓글 내용
- 더보기 메뉴 (본인 댓글만)
  - 삭제

**댓글 작성**:
- 하단 고정 입력창
- Placeholder: "댓글을 입력하세요"
- 멘션 지원 (@username)
- 전송 버튼 (아이콘)

**알림 발송**:
1. 일지 작성자에게 (본인 제외)
2. 멘션된 사용자에게
3. 같은 일지에 댓글 남긴 사람들에게 (중복 제거)

---

## 6. 팀 운동 생성 (Training Event Create)

**경로**: `/training/create`
**접근**: 로그인 + ADMIN 권한

### 6.1 기본 정보

**제목** (필수)
- 예: "정기 운동", "번개 경기"
- 1-50자

**날짜 및 시간** (필수)
- 날짜 선택
- 시간 선택 (예: 19:00)

**장소** (필수)
- 최근 사용 장소 목록
- 직접 입력 (자동완성)
- 새 장소 등록 시 Venue 생성

**Venue 정보** (선택):
- 주소
- 바닥 종류 (잔디, 인조잔디, 우레탄 등)
- 추천 신발 (FG, AG, TF)

**복장** (선택)
- 텍스트 에리어
- 예: "흰색 상의, 검정 하의"

**메모** (선택)
- 텍스트 에리어
- 예: "공 2개 가져오기", "날씨 확인 필수"

### 6.2 RSVP 설정

**마감 시간** (필수)
- 기본값: 운동 시작 2시간 전
- 날짜 + 시간 선택기

**리마인더**:
- 자동 발송 (Cron Job)
- 마감 2시간 전, 미응답자에게 푸시 알림

### 6.3 조끼 당번

**자동 추천**:
- 팀 설정의 `vestOrder` 배열 기반
- 순서대로 로테이션
- 최근 담당자 건너뛰기

**수동 선택**:
- 가져오기 담당 (1명)
- 가져가기 담당 (1명)
- 미지정 가능

**알림**:
- 운동 생성 시 조끼 담당자에게 푸시 알림
- 운동 1일 전 리마인더

### 6.4 POM 투표 설정

**활성화 여부**: 토글 (기본값: ON)

**마감 시간** (필수):
- 기본값: 운동 종료 후 2시간
- 날짜 + 시간 선택기

**투표 수** (필수):
- 1인 N표 (기본값: 1)
- 1-3 범위

### 6.5 저장

- "운동 만들기" 버튼
- 성공 시:
  - 팀 전체에 푸시 알림 (생성자 제외)
  - 운동 상세 페이지로 리다이렉트

---

## 7. 팀 운동 상세 (Training Event Detail)

**경로**: `/training/[id]`
**접근**: 로그인 + 같은 팀 멤버

### 7.1 운동 정보

**헤더**:
- 제목
- 날짜 · 시간
- 장소 (주소, 추천 신발)
- 복장
- 메모

**조직자**:
- 생성자 이름 + 아바타

**통계**:
- 참석: N명 (초록)
- 지각: N명 (주황)
- 불참: N명 (회색)
- 미응답: N명 (연한 회색)

### 7.2 RSVP (참석 여부)

**본인 응답 상태** (상단 카드):
- 참석 / 지각 / 불참 버튼
- 현재 선택 강조 표시
- 지각/불참 선택 시 이유 입력 (선택)

**변경 가능 시기**:
- RSVP 마감 전까지

**마감 후**:
- 응답 불가, 현재 상태만 표시

### 7.3 참석자 목록

**그룹별 표시**:
- 참석 (ATTEND): 초록 배경
- 지각 (LATE): 주황 배경
- 불참 (ABSENT): 회색 배경
- 미응답: 연한 회색 배경

**각 참석자**:
- 아바타 + 이름 + 포지션
- 응답 시간 (예: "1시간 전 응답")
- 이유 (지각/불참인 경우)

### 7.4 세션 및 팀 배정 (ADMIN만 표시)

**세션 목록**:
- 예: "5 vs 5", "골키퍼 훈련"
- 순서 변경 가능 (드래그)
- 팀 배정 필요 여부 표시

**팀 배정**:
- A팀, B팀, C팀... (최대 6팀)
- 각 팀별 멤버 목록
- 드래그로 팀 이동

**알림**:
- "팀 배정 알리기" 버튼
- 탭 시 전체 참석자에게 푸시 알림

### 7.5 체크인 (ADMIN만 표시)

**체크인 목록**:
- 체크인 완료: 아바타 + 이름 + 시간
- 지각 여부 표시 (빨강 태그)

**체크인 추가**:
- 참석자 목록에서 선택
- 지각 여부 체크박스
- 저장 시 즉시 반영

### 7.6 지각비 (ADMIN만 표시)

**지각비 목록**:
- 대상자 + 금액 + 상태 (미납/완납)
- 상태 토글 가능

**지각비 추가**:
- 대상자 선택 (드롭다운)
- 금액 입력 (기본값: 5,000원)
- 저장

**알림**:
- "지각비 알리기" 버튼
- 탭 시 대상자들에게 푸시 알림

### 7.7 장비 담당

**장비 목록**:
- 팀 설정의 Equipment 불러오기
- 예: "공", "조끼", "마커콘"

**담당자 배정**:
- 각 장비별 담당자 선택 (ADMIN)
- 메모 입력 (예: "공 2개")

### 7.8 POM 투표

**투표 기간**:
- 마감 전: 투표 가능
- 마감 후: 결과만 표시

**투표 UI**:
- 참석자 목록 (카드 형태)
- 선택 버튼 (1인 N표)
- 이유 입력 (필수, 예: "골 결정력이 좋았어요")
- 제출 버튼

**결과 표시**:
- 득표 순으로 정렬
- 각 사람별 득표 수
- 투표한 사람들 목록 (+ 이유)
- 1위: 🏆 아이콘

### 7.9 하단 버튼 (ADMIN만 표시)

- "수정" → `/training/[id]/edit`
- "관리" → `/training/[id]/manage`
- "삭제" (확인 다이얼로그)

---

## 8. 팀 운동 관리 (Training Event Manage)

**경로**: `/training/[id]/manage`
**접근**: ADMIN 권한

### 기능

전체 운영 화면 (한 페이지)
- 세션 추가/삭제/순서 변경
- 팀 배정
- 체크인
- 지각비 관리
- 장비 담당 배정

---

## 9. 마이페이지 (My Page)

**경로**: `/my`
**접근**: 로그인 사용자

### 9.1 프로필 카드

- 프로필 사진 (Google 계정)
- 이름
- 포지션 + 등번호
- 팀명
- "프로필 수정" 버튼 → API 호출

### 9.2 메뉴

**내 활동**:
- 내 일지 (`/my/logs`)
- 참석한 운동 (`/my/training`)
- 내가 만든 운동 (`/my/training-events`) - ADMIN만

**팀 관리** (ADMIN만):
- 운영진 관리 (`/my/team-admin/admins`)
- 조끼 당번 관리 (`/my/team-admin/vest`)
- 팀 설정 (`/my/team-settings`)
- 팀 장비 관리 (`/my/team-equipment`)

**설정**:
- 알림 설정 (`/my/settings`)
- 로그아웃

### 9.3 통계 (추후)

- 총 일지 수
- 총 참석 운동 수
- 출석률
- 받은 좋아요 수
- POM 당선 횟수

---

## 10. 설정 (Settings)

**경로**: `/my/settings`
**접근**: 로그인 사용자

### 10.1 푸시 알림

**토글 스위치**:
- ON: 구독 중
- OFF: 미구독

**동작**:
- ON 전환 시:
  1. 브라우저 알림 권한 요청
  2. Service Worker 등록
  3. Push Manager 구독
  4. DB에 구독 정보 저장
- OFF 전환 시:
  1. 브라우저 구독 해제
  2. DB에서 구독 정보 삭제

**안내 문구**:
- 구독 중: "닦달, 댓글, 좋아요 등의 알림을 받고 있습니다"
- 미구독: "알림을 켜면 중요한 소식을 놓치지 않아요"

**브라우저 호환성**:
- Chrome, Firefox, Edge: 완벽 지원
- Safari (iOS): PWA 설치 필요

### 10.2 프로필 설정

- 이름 변경
- 포지션 변경
- 등번호 변경
- 저장 버튼

### 10.3 팀 설정

- 초대 코드 표시 (복사 버튼)
- 팀 나가기 (확인 다이얼로그)
  - 운영진이 1명이면 나가기 불가

---

## 11. 운영진 관리

**경로**: `/my/team-admin/admins`
**접근**: ADMIN 권한

### 기능

**현재 운영진 목록**:
- 아바타 + 이름 + 포지션
- "권한 해제" 버튼 (본인은 해제 불가)

**운영진 추가**:
- 일반 팀원 목록 표시
- "운영진으로 지정" 버튼
- 즉시 반영

**제약**:
- 팀 생성자는 항상 ADMIN (해제 불가)
- 최소 1명 이상의 ADMIN 필요

---

## 12. 조끼 당번 관리

**경로**: `/my/team-admin/vest`
**접근**: ADMIN 권한

### 기능

**순서 관리**:
- 팀원 목록 (드래그 가능)
- 순서 저장 → `Team.vestOrder` 배열 업데이트

**자동 추천 로직**:
- 새 운동 생성 시 `vestOrder[0]`을 추천
- 담당 후 배열 맨 뒤로 이동 (로테이션)

**활성화/비활성화**:
- 특정 팀원을 당번에서 제외 (삭제)
- 다시 추가 가능

---

## 13. 팀 장비 관리

**경로**: `/my/team-equipment`
**접근**: ADMIN 권한

### 기능

**장비 목록**:
- 이름 (예: "공", "조끼", "마커콘")
- 설명 (예: "5호 축구공 2개")
- 기본 담당자 (팀 레벨 고정)
- 순서 변경 가능 (드래그)

**장비 추가**:
- 이름 입력 (필수)
- 설명 입력 (선택)
- 담당자 선택 (선택)

**장비 수정/삭제**:
- 인라인 편집
- 삭제 (확인 다이얼로그)

**사용**:
- 팀 운동 생성 시 자동으로 불러옴
- 운동별 담당자 재배정 가능

---

## 14. 닦달 (Nudge)

**위치**: 피드, 마이페이지 등 (플로팅 버튼)

### 기능

**대상 선택**:
- 같은 팀 팀원 목록
- 본인 제외
- 최근 닦달 시간 표시 (예: "30분 전 닦달함")

**제약**:
- 1시간 1회만 가능
- 제한 시간 내 재시도 시 에러 표시

**발송**:
- 대상자에게 푸시 알림
- 내용: "{발송자}님이 운동하래요! 일지 올려주세요~"
- 클릭 시 `/write`로 이동

**기록**:
- `Nudge` 테이블에 저장
- 전광판 배너에 표시 (최근 2시간)

---

## 15. 출석 통계

**경로**: `/api/teams/attendance-rate` (API)
**사용처**: 팀 설정 페이지, 대시보드 (추후)

### 제공 데이터

**팀원별 출석률**:
- 이름
- 총 운동 수
- 참석 횟수
- 지각 횟수
- 불참 횟수
- 출석률 (%)

**전체 통계**:
- 평균 출석률
- 평균 참석 인원
- 가장 많이 사용한 장소

---

## 🔒 권한 및 제약

### ADMIN 전용 기능

- 팀 운동 생성/수정/삭제
- 세션 및 팀 배정
- 체크인 및 지각비 관리
- 장비 담당자 배정
- 운영진 관리
- 조끼 당번 관리
- 팀 설정 수정

### MEMBER 기능

- 일지 작성/수정/삭제 (본인만)
- 댓글 작성/삭제 (본인만)
- 좋아요
- RSVP 응답
- POM 투표
- 닦달 발송
- 프로필 수정 (본인만)

### 공통 제약

- 같은 팀 멤버만 콘텐츠 조회 가능
- 본인 일지만 수정/삭제 가능
- 본인 댓글만 삭제 가능
- 닦달은 1시간 1회 제한
- 푸시 알림은 구독자만 수신

---

**최종 수정일**: 2026-02-09
**버전**: 1.0.0
